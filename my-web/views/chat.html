<!DOCTYPE html>
<html lang="en" litewebchat-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenAi</title>
    <link type="text/css" href="https://cdn.jsdelivr.net/gh/MorFansLab/LiteWebChat_Frame/dist/css/litewebchat.min.css" rel="stylesheet"/>
    <link type="text/css" href="https://cdn.jsdelivr.net/gh/MorFansLab/LiteWebChat_Frame/dist/css/litewebchat_input.min.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/emoji-mart@latest/dist/browser.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/MorFansLab/LiteWebChat_Frame/dist/js/litewebchat_input.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/MorFansLab/LiteWebChat_Frame/dist/js/litewebchat_render.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/MorFansLab/LiteWebChat_Frame/lite-chatbox.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/MorFansLab/LiteWebChat_Frame/litewebchatinput.min.js"></script>
    <script src="https://unpkg.com/axios@0.27.2/dist/axios.min.js"></script>
</head>

<body>
<div class="lite-chatmaster">
    <div class="lite-chatbox">
    </div>

    <div class="lite-chatinput">
        <div class="lite-chatinput">
            <hr class="boundary" />
            <div aria-label="input area" class="editor chatinput" id="chatinput" contenteditable="true" ref="editor"></div>
            <button class="send">发送</button>
        </div>
    </div>
</div>
</body>
</html>


<script>
    const htmls = [];

    function send() {
        var message = document.getElementById("chatinput").innerText

        if (message.length < 1) {
            return
        }
        htmls.push({
            messageType: "text",
            headIcon: "./assets/img/go.jpg",
            name: "",
            position: "right",
            html: message,
        });
        document.getElementById("chatinput").innerText = "";

        htmls.push({
            messageType: "tips",
            html: "请稍等，正在查询中......",
        });
        beforeRenderingHTML(htmls, ".lite-chatbox");


        // sumbit(message)
    }

    document.querySelector(".send").onclick = send;

    document.onkeydown = function () {
        var e = window.event || arguments.callee.caller.arguments[0];
        e.keyCode === 13 && send();
    };

    function sumbit(message) {
        var data = JSON.stringify({
            model: "text-davinci-003",
            prompt: message,
            temperature: 0,
            max_tokens: 2048,
        });
        var config = {
            method: "post",
            url: "https://api.openai.com/v1/completions",
            headers: {
                "Content-Type": "application/json",
                Authorization: "Bearer 123",
            },
            data: data,
        };
        axios(config).then(
            (response) => {
                console.log(response.data);
                var txt = response.data.choices[0].text;

                htmls.push({
                    messageType: "text",
                    headIcon: "./assets/img/openai.jpeg",
                    name: "ChatGPT",
                    position: "left",
                    html: txt,
                });
                beforeRenderingHTML(htmls, ".lite-chatbox");
            },
            (error) => {
                console.log("请求失败了", error.message);

                htmls.push({
                    messageType: "tips",
                    html: "查询失败：" + error.message,
                });
                beforeRenderingHTML(htmls, ".lite-chatbox");
            }
        );
    }
</script>

<style >
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
    }

    .lite-chatmaster {
        height: 100%;
        width: 100%;
    }
</style>